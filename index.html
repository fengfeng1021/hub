<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS // SYSTEM</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Orbitron for titles, JetBrains Mono for code -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#030508',
                        panel: '#0a0f16',
                        border: '#1f2937',
                        cyan: '#00f3ff',
                        neon: '#00f3ff',
                        dim: '#4b5563',
                    },
                    fontFamily: {
                        display: ['Orbitron', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glitch': 'glitch 1s linear infinite',
                        'scan': 'scan 2s linear infinite',
                    },
                    keyframes: {
                        glitch: {
                            '2%, 64%': { transform: 'translate(2px,0) skew(0deg)' },
                            '4%, 60%': { transform: 'translate(-2px,0) skew(0deg)' },
                            '62%': { transform: 'translate(0,0) skew(5deg)' },
                        },
                        scan: {
                            '0%': { backgroundPosition: '0% 0%' },
                            '100%': { backgroundPosition: '0% 100%' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #030508; 
            color: #e5e7eb; 
            overflow-x: hidden;
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        /* Glitch Title Effect */
        .glitch-text {
            position: relative;
        }
        .glitch-text::before, .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .glitch-text::before {
            left: 2px;
            text-shadow: -1px 0 #ff00c1;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        .glitch-text::after {
            left: -2px;
            text-shadow: -1px 0 #00fff9;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip: rect(30px, 9999px, 10px, 0); }
            20% { clip: rect(80px, 9999px, 90px, 0); }
            40% { clip: rect(10px, 9999px, 50px, 0); }
            60% { clip: rect(40px, 9999px, 20px, 0); }
            80% { clip: rect(70px, 9999px, 90px, 0); }
            100% { clip: rect(20px, 9999px, 60px, 0); }
        }
        @keyframes glitch-anim2 {
            0% { clip: rect(10px, 9999px, 80px, 0); }
            20% { clip: rect(60px, 9999px, 10px, 0); }
            40% { clip: rect(30px, 9999px, 60px, 0); }
            60% { clip: rect(80px, 9999px, 40px, 0); }
            80% { clip: rect(20px, 9999px, 70px, 0); }
            100% { clip: rect(50px, 9999px, 30px, 0); }
        }

        /* Card Hover Glow */
        .cyber-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .cyber-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 2px; height: 100%;
            background: #00f3ff;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 0 10px #00f3ff;
        }
        .cyber-card:hover::before {
            opacity: 1;
        }
        .cyber-card:hover {
            background: rgba(0, 243, 255, 0.03);
            border-color: rgba(0, 243, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.05);
            transform: translateX(5px);
        }

        /* Scanline Overlay */
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const Icon = ({ d, size = 16, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} dangerouslySetInnerHTML={{ __html: d }} />
        );
        const icons = {
            settings: '<path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>',
            link: '<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>',
            sparkles: '<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3z"/>',
            search: '<circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>',
            edit: '<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>',
            close: '<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>',
            cpu: '<rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><path d="M9 1v3"/><path d="M15 1v3"/><path d="M9 20v3"/><path d="M15 20v3"/><path d="M20 9h3"/><path d="M20 14h3"/><path d="M1 9h3"/><path d="M1 14h3"/>'
        };

        // --- Intro Sequence Component ---
        const BootSequence = ({ onComplete }) => {
            const [logs, setLogs] = useState([]);
            const [progress, setProgress] = useState(0);

            useEffect(() => {
                const steps = [
                    "INITIALIZING KERNEL...",
                    "CONNECTING TO GITHUB API...",
                    "LOADING NEURAL ENGINE...",
                    "ESTABLISHING SECURE CONNECTION...",
                    "ACCESS GRANTED."
                ];
                
                let currentStep = 0;
                
                const timer = setInterval(() => {
                    if (currentStep < steps.length) {
                        setLogs(prev => [...prev, steps[currentStep]]);
                        currentStep++;
                        setProgress(prev => prev + 20);
                    } else {
                        clearInterval(timer);
                        setTimeout(onComplete, 800);
                    }
                }, 300);

                return () => clearInterval(timer);
            }, []);

            return (
                <div className="fixed inset-0 bg-black z-[999] flex flex-col items-center justify-center font-mono text-neon p-4">
                    <div className="w-full max-w-md space-y-4">
                        <h1 className="text-4xl font-display font-bold text-center mb-8 glitch-text" data-text="NEXUS // OS">NEXUS // OS</h1>
                        <div className="border border-dim bg-panel p-4 h-48 overflow-hidden rounded flex flex-col justify-end">
                            {logs.map((log, i) => (
                                <div key={i} className="text-xs text-green-400">
                                    <span className="text-dim">[{new Date().toLocaleTimeString()}]</span> {log}
                                </div>
                            ))}
                            <div className="text-xs text-neon animate-pulse mt-1">_</div>
                        </div>
                        <div className="h-1 w-full bg-border rounded overflow-hidden">
                            <div className="h-full bg-neon transition-all duration-300 ease-out" style={{width: `${progress}%`}}></div>
                        </div>
                        <div className="flex justify-between text-xs text-dim">
                            <span>SYSTEM BOOT</span>
                            <span>{progress}%</span>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [booted, setBooted] = useState(false);
            const [username, setUsername] = useState('');
            const [apiKey, setApiKey] = useState('');
            const [repos, setRepos] = useState([]);
            const [status, setStatus] = useState('idle');
            const [aiStatus, setAiStatus] = useState('idle'); 
            const [showSettings, setShowSettings] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            
            const [editingRepo, setEditingRepo] = useState(null);
            const [editTitle, setEditTitle] = useState('');
            const [editDesc, setEditDesc] = useState('');

            useEffect(() => {
                const u = localStorage.getItem('nexus_user');
                const k = localStorage.getItem('nexus_key');
                if (u) setUsername(u);
                if (k) setApiKey(k);
                if (u) fetchRepos(u);
            }, []);

            const fetchRepos = async (user) => {
                if (!user) return;
                setStatus('loading');
                try {
                    const res = await fetch(`https://api.github.com/users/${user}/repos?sort=updated&per_page=100&type=owner`);
                    if (!res.ok) throw new Error('CONNECTION REFUSED');
                    const data = await res.json();
                    
                    const hidden = ['hub', 'nav', `${user.toLowerCase()}.github.io`];
                    
                    const list = data
                        .filter(r => r.has_pages)
                        .filter(r => !hidden.includes(r.name.toLowerCase()))
                        .map(r => ({
                            id: r.id,
                            name: r.name,
                            desc: r.description,
                            url: r.homepage || `https://${user}.github.io/${r.name}`,
                            date: r.updated_at.split('T')[0],
                            manualTitle: localStorage.getItem(`manual_t_${r.id}`),
                            manualDesc: localStorage.getItem(`manual_d_${r.id}`),
                            aiTitle: localStorage.getItem(`t_${r.id}`),
                            aiDesc: localStorage.getItem(`d_${r.id}`)
                        }));
                    
                    setRepos(list);
                    setStatus('idle');
                } catch (e) {
                    alert(e.message);
                    setStatus('error');
                }
            };

            const runAI = async () => {
                if (!apiKey) { setShowSettings(true); return; }
                const targets = repos.filter(r => !r.manualTitle); 
                if (!targets.length) { alert("NO TARGETS FOUND FOR ANALYSIS"); return; }

                setAiStatus('processing');
                const items = targets.map(r => `ID:${r.id} | Name:${r.name} | GitHubDesc:${r.desc || 'None'}`).join('\n');
                
                const prompt = `
                    Act as a Sci-Fi Interface Designer.
                    Task: Rename these web apps for a Cyberpunk HUD.
                    Language: Traditional Chinese (Taiwan).
                    Style: High-tech, Powerful, Concise.
                    
                    Input:
                    ${items}

                    Output JSON: [{"id": 123, "title": "...", "desc": "..."}]
                `;

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ 
                            contents: [{ parts: [{ text: prompt }] }],
                            safetySettings: [{ category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }]
                        })
                    });
                    
                    const json = await res.json();
                    if (json.error) throw new Error(json.error.message);
                    
                    let txt = json.candidates?.[0]?.content?.parts?.[0]?.text || "[]";
                    const match = txt.match(/\[.*\]/s);
                    const results = match ? JSON.parse(match[0]) : [];

                    const newRepos = repos.map(r => {
                        const hit = results.find(x => x.id === r.id);
                        if (hit) {
                            localStorage.setItem(`t_${r.id}`, hit.title);
                            localStorage.setItem(`d_${r.id}`, hit.desc);
                            return { ...r, aiTitle: hit.title, aiDesc: hit.desc };
                        }
                        return r;
                    });
                    setRepos(newRepos);
                    setAiStatus('done');
                    setTimeout(() => setAiStatus('idle'), 2000);
                } catch (e) {
                    alert("SYSTEM ERROR: " + e.message);
                    setAiStatus('error');
                }
            };

            const openEdit = (e, repo) => {
                e.preventDefault();
                setEditingRepo(repo);
                setEditTitle(repo.manualTitle || repo.aiTitle || repo.name);
                setEditDesc(repo.manualDesc || repo.aiDesc || repo.desc || '');
            };

            const saveEdit = () => {
                if (!editingRepo) return;
                localStorage.setItem(`manual_t_${editingRepo.id}`, editTitle);
                localStorage.setItem(`manual_d_${editingRepo.id}`, editDesc);
                setRepos(repos.map(r => r.id === editingRepo.id ? { ...r, manualTitle: editTitle, manualDesc: editDesc } : r));
                setEditingRepo(null);
            };

            const saveSettings = () => {
                localStorage.setItem('nexus_user', username);
                localStorage.setItem('nexus_key', apiKey);
                setShowSettings(false);
                fetchRepos(username);
            };

            const filtered = repos.filter(r => {
                const displayTitle = r.manualTitle || r.aiTitle || r.name;
                return displayTitle.toLowerCase().includes(searchTerm.toLowerCase());
            });

            if (!booted) return <BootSequence onComplete={() => setBooted(true)} />;

            return (
                <div className="relative min-h-screen font-mono text-gray-300">
                    <div className="scanlines"></div>
                    
                    <div className="max-w-4xl mx-auto px-6 py-12 relative z-10">
                        
                        {/* HUD Header */}
                        <div className="flex items-end justify-between mb-12 border-b border-neon/30 pb-4 relative">
                            <div className="absolute bottom-0 left-0 w-1/3 h-[2px] bg-neon shadow-[0_0_10px_#00f3ff]"></div>
                            <div>
                                <h1 className="text-4xl md:text-5xl font-display font-black text-white glitch-text" data-text="NEXUS // HUB">
                                    NEXUS // HUB
                                </h1>
                                <p className="text-xs text-neon mt-2 tracking-[0.3em]">SYSTEM ONLINE â€¢ V5.0.1</p>
                            </div>
                            <button onClick={() => setShowSettings(true)} className="group flex items-center gap-2 text-dim hover:text-neon transition-colors">
                                <span className="text-[10px] hidden md:block opacity-0 group-hover:opacity-100 transition-opacity">[CONFIG]</span>
                                <Icon d={icons.settings} size={20} />
                            </button>
                        </div>

                        {/* Control Deck */}
                        <div className="flex gap-4 mb-10 p-1 bg-panel border border-border rounded-lg relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-4 h-4 border-t border-r border-neon"></div>
                            <div className="absolute bottom-0 left-0 w-4 h-4 border-b border-l border-neon"></div>
                            
                            <div className="relative flex-1 flex items-center px-3 gap-3">
                                <Icon d={icons.search} className="text-dim" />
                                <input value={searchTerm} onChange={e => setSearchTerm(e.target.value)} placeholder="SEARCH PROTOCOL..." className="w-full bg-transparent text-sm text-neon focus:outline-none placeholder-gray-700 font-bold" />
                            </div>
                            <button onClick={runAI} disabled={aiStatus === 'processing'} className="bg-border hover:bg-neon/10 hover:text-neon px-4 py-2 text-xs font-bold transition-all flex items-center gap-2 border-l border-border">
                                {aiStatus === 'processing' ? <Icon d={icons.cpu} className="animate-spin" /> : <Icon d={icons.sparkles} />}
                                <span>{aiStatus === 'processing' ? 'COMPUTING...' : 'AI ENHANCE'}</span>
                            </button>
                        </div>

                        {/* Data Grid */}
                        <div className="space-y-4">
                            {status === 'loading' && <div className="text-center text-neon animate-pulse font-display">SYNCING DATABASE...</div>}
                            
                            {filtered.map(repo => {
                                const title = repo.manualTitle || repo.aiTitle || repo.name;
                                const desc = repo.manualDesc || repo.aiDesc || repo.desc || 'NO DATA AVAILABLE';
                                const isManual = !!repo.manualTitle;
                                const isAI = !isManual && repo.aiTitle;

                                return (
                                    <div key={repo.id} className="cyber-card group bg-panel border border-border rounded flex items-center justify-between p-5">
                                        <a href={repo.url} target="_blank" className="flex-1 pr-8">
                                            <div className="flex items-center gap-3 mb-1">
                                                <h3 className="text-xl font-bold text-white font-display tracking-wide group-hover:text-neon transition-colors">{title}</h3>
                                                {isManual && <span className="text-[9px] bg-white text-black px-1 font-bold">MANUAL</span>}
                                                {isAI && <span className="text-[9px] border border-neon text-neon px-1">AI_GEN</span>}
                                            </div>
                                            <p className="text-sm text-dim group-hover:text-gray-400 transition-colors uppercase tracking-tight">{desc}</p>
                                        </a>
                                        
                                        <div className="flex items-center gap-4 border-l border-border pl-6 relative">
                                            <button onClick={(e) => openEdit(e, repo)} className="p-2 text-dim hover:text-white hover:bg-white/10 rounded transition-colors" title="OVERRIDE">
                                                <Icon d={icons.edit} />
                                            </button>
                                            <a href={repo.url} target="_blank" className="text-neon opacity-50 group-hover:opacity-100 hover:scale-110 transition-all shadow-[0_0_15px_#00f3ff]">
                                                <Icon d={icons.link} size={24} />
                                            </a>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {/* Footer Status */}
                        <div className="mt-16 flex justify-between text-[10px] text-dim font-mono border-t border-border pt-4">
                            <span>NODES DETECTED: {repos.length}</span>
                            <span>SECURE CONNECTION ESTABLISHED</span>
                        </div>
                    </div>

                    {/* Modals (Settings & Edit) - Styled to match */}
                    {(showSettings || editingRepo) && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-bg border border-neon w-full max-w-md p-6 relative shadow-[0_0_30px_rgba(0,243,255,0.1)]">
                                <h2 className="text-xl font-display font-bold text-white mb-6 glitch-text" data-text={showSettings ? "CONFIG" : "OVERRIDE"}>
                                    {showSettings ? "SYSTEM CONFIG" : "DATA OVERRIDE"}
                                </h2>
                                
                                {showSettings ? (
                                    <div className="space-y-4">
                                        <input value={username} onChange={e => setUsername(e.target.value)} className="w-full bg-panel border border-dim focus:border-neon p-3 text-neon outline-none" placeholder="GITHUB USER" />
                                        <input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} className="w-full bg-panel border border-dim focus:border-neon p-3 text-neon outline-none" placeholder="API KEY" />
                                        <div className="flex gap-3 pt-2">
                                            <button onClick={() => setShowSettings(false)} className="flex-1 py-3 border border-dim text-dim hover:text-white hover:border-white text-xs font-bold">ABORT</button>
                                            <button onClick={saveSettings} className="flex-1 py-3 bg-neon text-black font-bold text-xs hover:bg-white transition-colors">EXECUTE</button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <input value={editTitle} onChange={e => setEditTitle(e.target.value)} className="w-full bg-panel border border-dim focus:border-neon p-3 text-neon outline-none font-bold" placeholder="TITLE" />
                                        <textarea value={editDesc} onChange={e => setEditDesc(e.target.value)} className="w-full bg-panel border border-dim focus:border-neon p-3 text-gray-400 outline-none h-24 resize-none" placeholder="DESCRIPTION" />
                                        <div className="flex gap-3 pt-2">
                                            <button onClick={() => setEditingRepo(null)} className="flex-1 py-3 border border-dim text-dim hover:text-white hover:border-white text-xs font-bold">CANCEL</button>
                                            <button onClick={saveEdit} className="flex-1 py-3 bg-white text-black font-bold text-xs hover:bg-neon hover:text-black transition-colors">SAVE DATA</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>